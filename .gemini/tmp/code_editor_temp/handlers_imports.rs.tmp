use super::state::{AppState, LogState};
use super::error::AppError;
use super::config_update::ConfigUpdate;
use super::utils::{remove_null_values, create_and_execute_restart_script};
use crate::cli::AppConfig;
use crate::models::{AnthropicRequest, CountTokensRequest};
use crate::router::MessageRouter;
use crate::providers::ProviderRegistry;
use crate::auth::TokenStore;
use crate::server::{oauth_handlers, openai_compat};
use axum::{
    extract::{State, Path, Query, Form, Extension},
    http::{HeaderMap, StatusCode, Request},
    response::{Html, IntoResponse, Response, sse::{Event, Sse}, Redirect},
    routing::{get, post},
    Json, Router,
    body::Body,
    middleware::{from_fn, Next},
};
use axum_extra::{headers::UserAgent, TypedHeader};
use std::sync::Arc;
use tracing::{error, info, debug, warn};
use futures::stream::StreamExt;
use anyhow::Context;
use toml;
use serde_json::Value; // Added this import